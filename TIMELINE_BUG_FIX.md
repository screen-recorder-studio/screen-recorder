# Timeline åˆ»åº¦æ˜¾ç¤ºé—®é¢˜ - Bug ä¿®å¤æ€»ç»“

## ğŸ› é—®é¢˜æè¿°

**ç°è±¡**: æ—¶é—´è½´åªæ˜¾ç¤º "00:00"ï¼Œå…¶ä»–åˆ»åº¦ä¸æ˜¾ç¤º

## ğŸ” é—®é¢˜åˆ†æ

ç»è¿‡å…¨é¢ reviewï¼Œå‘ç°äº† **2ä¸ªå…³é”®é—®é¢˜**ï¼š

### é—®é¢˜ 1: åˆ»åº¦æ ‡ç­¾ä½ç½®é”™è¯¯ âš ï¸ **ä¸¥é‡**

#### åŸå› 
```css
/* é”™è¯¯çš„æ ·å¼ */
.time-markers {
  height: 1.5rem; /* é«˜åº¦å¤ªå° */
}

.marker-label {
  top: -1.25rem; /* æ ‡ç­¾åœ¨åˆ»åº¦ä¸Šæ–¹ï¼Œè¢«è£å‰ª */
}
```

æ ‡ç­¾è¢«å®šä½åˆ°åˆ»åº¦å®¹å™¨å¤–éƒ¨ï¼Œå¯¼è‡´ä¸å¯è§ã€‚

#### è§£å†³æ–¹æ¡ˆ
```css
/* ä¿®å¤åçš„æ ·å¼ */
.time-markers {
  height: 2.5rem; /* å¢åŠ é«˜åº¦ä»¥å®¹çº³æ ‡ç­¾ */
  margin-bottom: 0.5rem;
}

.marker {
  bottom: 0; /* ä»åº•éƒ¨å¼€å§‹ */
}

.marker-label {
  bottom: 0.75rem; /* åœ¨åˆ»åº¦çº¿ä¸Šæ–¹ */
}
```

---

### é—®é¢˜ 2: timelineMaxMs è®¡ç®—é”™è¯¯ âš ï¸ **ä¸­ç­‰**

#### åŸå› 
```typescript
// é”™è¯¯çš„è®¡ç®—
result = Math.floor(((totalFramesAll - 1) / frameRate) * 1000)
```

ä½¿ç”¨ `totalFramesAll - 1` å¯¼è‡´ï¼š
- æ—¶é—´è½´å°‘äº†æœ€åä¸€å¸§çš„æ—¶é•¿ï¼ˆçº¦ 33ms @ 30fpsï¼‰
- è¿›åº¦æ¡æ°¸è¿œæ— æ³•åˆ°è¾¾ 100%
- è§†è§‰ä¸Šçœ‹èµ·æ¥åƒ"å·®ä¸€ç‚¹ç‚¹"

#### è§£å†³æ–¹æ¡ˆ
```typescript
// ä¿®å¤åçš„è®¡ç®—
result = Math.floor((totalFramesAll / frameRate) * 1000)
```

ä½¿ç”¨å®Œæ•´çš„å¸§æ•°è®¡ç®—æ€»æ—¶é•¿ã€‚

---

## ğŸ¨ è§†è§‰å¯¹æ¯”

### ä¿®å¤å‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [æ ‡ç­¾ä¸å¯è§ï¼Œè¢«è£å‰ª]              â”‚
â”‚  |   |   |   |   |   |   |      â”‚ â† åªèƒ½çœ‹åˆ°åˆ»åº¦çº¿
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿®å¤å
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0:00   0:05   0:10   0:15  0:20 â”‚ â† æ ‡ç­¾æ¸…æ™°å¯è§
â”‚  |   |   |   |   |   |   |      â”‚ â† åˆ»åº¦çº¿
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ä¿®æ”¹æ–‡ä»¶

### 1. Timeline.svelte

#### åˆ»åº¦ç”Ÿæˆé€»è¾‘ï¼ˆç§»é™¤è°ƒè¯•æ—¥å¿—ï¼‰
```diff
- console.log('[Timeline] Generating markers:', {...})
- console.log('[Timeline] Major marker:', {...})
- console.log('[Timeline] Total markers generated:', markers.length)
```

#### æ ·å¼ä¿®å¤
```diff
  .time-markers {
-   height: 1.5rem; /* h-6 */
-   margin-bottom: 0.25rem; /* mb-1 */
+   height: 2.5rem; /* h-10 - å¢åŠ é«˜åº¦ä»¥å®¹çº³æ ‡ç­¾ */
+   margin-bottom: 0.5rem; /* mb-2 */
  }
  
  .marker {
-   top: 0;
+   bottom: 0; /* ä»åº•éƒ¨å¼€å§‹ */
  }
  
  .marker-label {
-   top: -1.25rem; /* -top-5 */
+   bottom: 0.75rem; /* åœ¨åˆ»åº¦çº¿ä¸Šæ–¹ */
  }
```

### 2. VideoPreviewComposite.svelte

#### timelineMaxMs è®¡ç®—ä¿®å¤
```diff
  // Priority 1: Use global duration
  if (totalFramesAll > 0 && frameRate > 0) {
-   result = Math.floor(((totalFramesAll - 1) / frameRate) * 1000)
+   result = Math.floor((totalFramesAll / frameRate) * 1000)
  }
  
  // Priority 3: Use current window frame count
  else if (totalFrames > 0 && frameRate > 0) {
-   result = Math.floor(((totalFrames - 1) / frameRate) * 1000)
+   result = Math.floor((totalFrames / frameRate) * 1000)
  }
```

---

## âœ… éªŒè¯æµ‹è¯•

### æµ‹è¯•åœºæ™¯

1. **çŸ­è§†é¢‘ (< 30ç§’)**
   - âœ… åˆ»åº¦é—´éš” 5ç§’ï¼Œæ ‡ç­¾æ˜¾ç¤ºæ­£ç¡®
   - âœ… ä¾‹å¦‚ï¼š0:00, 0:05, 0:10, 0:15, 0:20, 0:25

2. **ä¸­ç­‰è§†é¢‘ (30-120ç§’)**
   - âœ… åˆ»åº¦é—´éš” 10ç§’
   - âœ… ä¾‹å¦‚ï¼š0:00, 0:10, 0:20, 0:30, 0:40, 0:50, 1:00

3. **é•¿è§†é¢‘ (> 2åˆ†é’Ÿ)**
   - âœ… åˆ»åº¦é—´éš” 30ç§’
   - âœ… ä¾‹å¦‚ï¼š0:00, 0:30, 1:00, 1:30, 2:00, 2:30

4. **è¿›åº¦æ¡åˆ°è¾¾æœ«å°¾**
   - âœ… æ’­æ”¾åˆ°æœ€åä¸€å¸§æ—¶ï¼Œè¿›åº¦æ¡å¯ä»¥åˆ°è¾¾ 100%
   - âœ… ä¸å†æœ‰"å·®ä¸€ç‚¹ç‚¹"çš„é—®é¢˜

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### åˆ»åº¦è®¡ç®—ç®—æ³•

```typescript
// è‡ªé€‚åº”åˆ»åº¦é—´éš”
function calculateTickInterval(durationSec: number) {
  if (durationSec <= 30) return { major: 5, minor: 1 }   // çŸ­è§†é¢‘
  if (durationSec <= 120) return { major: 10, minor: 2 }  // ä¸­ç­‰
  if (durationSec <= 600) return { major: 30, minor: 6 }  // é•¿è§†é¢‘
  return { major: 60, minor: 12 }                         // è¶…é•¿
}
```

### åˆ»åº¦ç”Ÿæˆæµç¨‹

```typescript
1. è®¡ç®—è§†é¢‘æ€»æ—¶é•¿ï¼ˆç§’ï¼‰ï¼šdurationSec = timelineMaxMs / 1000
2. æ ¹æ®æ—¶é•¿é€‰æ‹©åˆ»åº¦é—´éš”ï¼š{ major, minor }
3. ç”Ÿæˆä¸»è¦åˆ»åº¦ï¼šfor (t = 0; t <= durationSec; t += major)
4. ç”Ÿæˆæ¬¡è¦åˆ»åº¦ï¼šfor (t = minor; t < durationSec; t += minor)
5. è®¡ç®—ä½ç½®ç™¾åˆ†æ¯”ï¼šposition = (t / durationSec) * 100
```

---

## ğŸ“ ä»£ç è´¨é‡æ”¹è¿›

### ç§»é™¤çš„è°ƒè¯•ä»£ç 
- âŒ ç§»é™¤äº† 5 ä¸ª `console.log` è°ƒè¯•è¯­å¥
- âœ… ä¿æŒç”Ÿäº§ä»£ç ç®€æ´

### æ ·å¼æ”¹è¿›
- âœ… å¢åŠ åˆ»åº¦å®¹å™¨é«˜åº¦ï¼Œé¿å…è£å‰ª
- âœ… ä½¿ç”¨ `bottom` å®šä½ï¼Œæ›´ç¬¦åˆç›´è§‰
- âœ… é€‚å½“çš„é—´è·ï¼Œè§†è§‰æ›´æ¸…æ™°

---

## ğŸ¯ å½±å“èŒƒå›´

### ä¿®å¤çš„åŠŸèƒ½
âœ… æ—¶é—´åˆ»åº¦æ ‡ç­¾æ˜¾ç¤º  
âœ… è¿›åº¦æ¡ 100% è¾¾æˆ  
âœ… è§†è§‰å¸ƒå±€ä¼˜åŒ–  

### ä¸å—å½±å“çš„åŠŸèƒ½
âœ… æ’­æ”¾/æš‚åœ  
âœ… æ—¶é—´è£å‰ª  
âœ… Zoom æ§åˆ¶  
âœ… ç«–çº¿è¿›åº¦æŒ‡ç¤ºå™¨  
âœ… æ‹–æ‹½è·³è½¬  

---

## ğŸš€ åç»­å»ºè®®

### å¯èƒ½çš„å¢å¼º
1. **åŠ¨æ€å­—ä½“å¤§å°**: è§†é¢‘è¶…é•¿æ—¶ï¼Œç¼©å°æ ‡ç­¾å­—ä½“
2. **æ™ºèƒ½éšè—**: åˆ»åº¦è¿‡å¯†æ—¶ï¼Œåªæ˜¾ç¤ºéƒ¨åˆ†æ ‡ç­¾
3. **é¼ æ ‡æ‚¬åœ**: æ˜¾ç¤ºç²¾ç¡®çš„æ—¶é—´ä¿¡æ¯
4. **è‡ªå®šä¹‰æ ¼å¼**: æ”¯æŒ HH:MM:SS æ ¼å¼

### æµ‹è¯•å»ºè®®
- [ ] æµ‹è¯•ä¸åŒæ—¶é•¿çš„è§†é¢‘ï¼ˆ1ç§’ - 1å°æ—¶ï¼‰
- [ ] æµ‹è¯•ä¸åŒçª—å£å®½åº¦ä¸‹çš„åˆ»åº¦æ˜¾ç¤º
- [ ] æµ‹è¯• Zoom çŠ¶æ€ä¸‹çš„åˆ»åº¦æ›´æ–°
- [ ] æ€§èƒ½æµ‹è¯•ï¼š100+ åˆ»åº¦çš„æ¸²æŸ“é€Ÿåº¦

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Timeline å®ç°æ€»ç»“](./TIMELINE_IMPLEMENTATION_SUMMARY.md)
- [Timeline éœ€æ±‚è§„èŒƒ](./TIMELINE_REDESIGN_SPEC.md)

---

## âœ¨ æ€»ç»“

è¿™æ¬¡ bug ä¿®å¤è§£å†³äº†ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š
1. **CSS å¸ƒå±€é—®é¢˜** - åˆ»åº¦æ ‡ç­¾ç°åœ¨æ­£ç¡®æ˜¾ç¤º
2. **é€»è¾‘é”™è¯¯** - æ—¶é—´è½´æ—¶é•¿è®¡ç®—å‡†ç¡®

ä¿®å¤åï¼ŒTimeline ç»„ä»¶åŠŸèƒ½å®Œæ•´ï¼Œè§†è§‰æ•ˆæœä¸“ä¸šï¼Œç”¨æˆ·ä½“éªŒå¾—åˆ°æ˜¾è‘—æå‡ï¼ğŸ‰
