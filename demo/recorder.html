<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaaS Video Recorder - å½•åˆ¶ä¸­</title>
    <link rel="stylesheet" href="popup/popup.css">
    <link rel="stylesheet" href="popup/formatSelector.css">
    <style>
        body {
            width: 100%;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
        }
        .container {
            width: 500px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.1);
        }
        .recording-timer {
            font-size: 48px;
            font-weight: bold;
            color: #dc3545;
            text-align: center;
            margin: 20px 0;
        }
        .status-large {
            font-size: 24px;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>è§†é¢‘å½•åˆ¶å™¨</h1>
        </header>
        
        <main class="main">
            <!-- å½•åˆ¶æ§åˆ¶åŒºåŸŸ -->
            <div id="recording-section" class="section">
                <div class="status-large" id="status-large">å‡†å¤‡å½•åˆ¶</div>
                <div class="recording-timer" id="recording-timer" style="display: none;">00:00</div>
                
                <div class="status-display">
                    <span id="status-text">å‡†å¤‡å½•åˆ¶</span>
                    <div id="recording-indicator" class="indicator"></div>
                </div>
                
                <div class="controls">
                    <button id="start-btn" class="btn btn-primary">å¼€å§‹å½•åˆ¶</button>
                    <button id="stop-btn" class="btn btn-secondary" disabled>åœæ­¢å½•åˆ¶</button>
                </div>
                
                <div class="recording-info">
                    <small id="recording-tip">ç‚¹å‡»å¼€å§‹å½•åˆ¶å½“å‰æ ‡ç­¾é¡µå†…å®¹</small>
                </div>
            </div>
            
            <!-- èƒŒæ™¯é€‰æ‹©åŒºåŸŸ (åˆå§‹éšè—) -->
            <div id="background-section" class="section hidden">
                <div class="background-header">
                    <h3>ç¼–è¾‘å’Œé¢„è§ˆè§†é¢‘</h3>
                    <p class="background-description">é¢„è§ˆå½•åˆ¶å†…å®¹å¹¶æ·»åŠ ä¸“ä¸šèƒŒæ™¯</p>
                </div>
                
                <!-- è§†é¢‘é¢„è§ˆåŒºåŸŸ -->
                <div class="video-preview-section">
                    <video id="video-preview" controls muted playsinline class="video-player"></video>
                    <canvas id="preview-canvas" class="preview-canvas"></canvas>
                </div>
                
                <!-- è®¾ç½®é¢æ¿ -->
                <div class="settings-panel">
                    <!-- èƒŒæ™¯é¢œè‰²é€‰æ‹© -->
                    <div class="setting-group">
                        <label class="setting-label">èƒŒæ™¯é¢œè‰²</label>
                        <div class="background-options">
                            <div class="bg-option-wrapper">
                                <button class="bg-option" data-color="#ffffff" data-name="çº¯ç™½" style="background-color: #ffffff; border: 2px solid #dee2e6;"></button>
                                <span class="bg-label">çº¯ç™½</span>
                            </div>
                            <div class="bg-option-wrapper">
                                <button class="bg-option" data-color="#f8f9fa" data-name="æµ…ç°" style="background-color: #f8f9fa;"></button>
                                <span class="bg-label">æµ…ç°</span>
                            </div>
                            <div class="bg-option-wrapper">
                                <button class="bg-option" data-color="#e9ecef" data-name="ä¸­ç°" style="background-color: #e9ecef;"></button>
                                <span class="bg-label">ä¸­ç°</span>
                            </div>
                            <div class="bg-option-wrapper">
                                <button class="bg-option" data-color="#1a1a1a" data-name="æ·±é»‘" style="background-color: #1a1a1a;"></button>
                                <span class="bg-label">æ·±é»‘</span>
                            </div>
                            <div class="bg-option-wrapper">
                                <button class="bg-option" data-color="#0066cc" data-name="å•†åŠ¡è“" style="background-color: #0066cc;"></button>
                                <span class="bg-label">å•†åŠ¡è“</span>
                            </div>
                            <div class="bg-option-wrapper">
                                <button class="bg-option" data-color="#10b981" data-name="é’ç»¿" style="background-color: #10b981;"></button>
                                <span class="bg-label">é’ç»¿</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å†…è¾¹è·é€‰æ‹© -->
                    <div class="setting-group">
                        <label class="setting-label">è§†é¢‘è¾¹è·</label>
                        <div class="padding-options">
                            <button class="padding-option active" data-padding="60">æ ‡å‡†</button>
                            <button class="padding-option" data-padding="100">å®½æ¾</button>
                            <button class="padding-option" data-padding="150">èˆ’é€‚</button>
                            <button class="padding-option" data-padding="200">å®½é˜”</button>
                            <button class="padding-option" data-padding="custom">è‡ªå®šä¹‰</button>
                        </div>
                        <div id="custom-padding-input" class="custom-padding-input hidden">
                            <input type="range" id="custom-padding-slider" min="0" max="300" value="60" step="10">
                            <span class="padding-value">è¾¹è·: <span id="custom-padding-value">60</span>px</span>
                        </div>
                    </div>
                    
                    <!-- è¾“å‡ºå°ºå¯¸é€‰æ‹© -->
                    <div class="setting-group">
                        <label class="setting-label">è¾“å‡ºå°ºå¯¸</label>
                        <div class="size-options">
                            <button class="size-option active" data-ratio="16:9">16:9 æ¨ªå±</button>
                            <button class="size-option" data-ratio="1:1">1:1 æ­£æ–¹å½¢</button>
                            <button class="size-option" data-ratio="9:16">9:16 ç«–å±</button>
                            <button class="size-option" data-ratio="4:5">4:5 Instagram</button>
                            <button class="size-option" data-ratio="custom">è‡ªå®šä¹‰</button>
                        </div>
                        <div id="custom-size-input" class="custom-size-input hidden">
                            <input type="number" id="custom-width" placeholder="å®½åº¦" min="100" max="4096" value="1920">
                            <span>Ã—</span>
                            <input type="number" id="custom-height" placeholder="é«˜åº¦" min="100" max="4096" value="1080">
                        </div>
                    </div>
                </div>
                
                <div class="background-info">
                    <div class="selected-info">
                        <span id="selected-bg-name">è¯·é€‰æ‹©èƒŒæ™¯é¢œè‰²</span>
                        <span id="selected-settings" class="settings-info">è¾¹è·: 60px | å°ºå¯¸: 16:9</span>
                    </div>
                </div>
                
                <div class="processing-controls">
                    <button id="apply-bg-btn" class="btn btn-primary" disabled>
                        <span class="btn-text">åº”ç”¨å¹¶ä¸‹è½½</span>
                        <span class="btn-loading hidden">å¤„ç†ä¸­...</span>
                    </button>
                    <button id="skip-bg-btn" class="btn btn-secondary">ç›´æ¥ä¸‹è½½åŸå§‹è§†é¢‘</button>
                    <button id="choose-format-btn" class="btn btn-secondary">
                        <span class="btn-icon">ğŸ“¦</span>
                        <span>é€‰æ‹©æ ¼å¼</span>
                    </button>
                </div>
            </div>
            
            <!-- è¿›åº¦æ˜¾ç¤ºåŒºåŸŸ -->
            <div id="progress-section" class="section hidden">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <p id="progress-text">å¤„ç†ä¸­...</p>
            </div>
        </main>
    </div>
    
    <!-- æ ¼å¼é€‰æ‹©å™¨æ¨¡æ€æ¡† -->
    <div id="format-selector-modal" class="format-selector-modal">
        <!-- æ ¼å¼é€‰æ‹©å™¨å†…å®¹å°†åŠ¨æ€æ’å…¥ -->
    </div>
    
    <!-- æ··åˆå½•åˆ¶æ–¹æ¡ˆ -->
    <script src="popup/hybrid-recorder.js"></script>
    <script src="universal-recorder.js"></script>
    
    <!-- Mediabunny åŠ è½½å™¨ -->
    <script src="mediabunny-loader.js"></script>
    <!-- <script src="libs/mp4box.all.js"></script> -->
    <!-- <script src="libs/gif.js"></script> -->
    <!-- <script src="libs/gif.worker.js"></script> -->

    <!-- æ™ºèƒ½å¯¼å‡ºç®¡ç† -->
    <script src="popup/mp4-quality-optimizer.js"></script>
    <script src="popup/text-flicker-fix.js"></script>
    <script src="popup/smart-text-renderer.js"></script>
    <script src="popup/mediabunny-mp4-exporter.js"></script>
    <script src="popup/smart-export-manager.js"></script>
    
    <!-- WebCodecs å¢å¼ºå¯¼å‡º -->
    <script src="popup/webcodecs-enhanced-exporter.js"></script>
    <script src="popup/webcodecs-integration-adapter.js"></script>
    
    <script src="popup/formatExportManager.js"></script>
    <script src="popup/formatSelector.js"></script>
    
    <!-- æ ¸å¿ƒåŠŸèƒ½ -->
    <script src="popup/videoRecorder.js"></script>
    <script src="popup/performance-monitor.js"></script>
    <script src="popup/fileManager.js"></script>
    <script src="popup/backgroundProcessor.js"></script>
    <script src="popup/popup.js"></script>
    <script src="popup/videoPreviewExtensions.js"></script>
    <script src="popup/recorderInit.js"></script>
    
    <!-- ç´§æ€¥ä¿®å¤ï¼šç¦ç”¨æœ‰é—®é¢˜çš„ WebCodecs ä¼˜åŒ– -->
    <script src="popup/emergency-fix.js"></script>

    <!-- Mediabunny é›†æˆæµ‹è¯• -->
    <!-- <script src="test-mediabunny-integration.js"></script> -->

    <!-- Mediabunny ä¿®å¤éªŒè¯ -->
    <!-- <script src="verify-mediabunny-fix.js"></script> -->
</body>
</html>
