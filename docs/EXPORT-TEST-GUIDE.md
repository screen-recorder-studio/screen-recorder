# 多格式导出功能测试指南

## 功能概述
现在视频录制器支持三种格式导出：
- **WebM** - 原始格式，最佳质量
- **MP4** - 通用格式，兼容性好
- **GIF** - 动图格式，易于分享

## 测试步骤

### 1. 基本录制和导出测试

1. 打开 `recorder.html`
2. 点击"开始录制"按钮
3. 录制 5-10 秒的视频
4. 点击"停止录制"
5. 录制完成后，点击"选择格式"按钮
6. 应该看到格式选择器界面

### 2. WebM 格式导出测试

在格式选择器中：
1. 选择 WebM 格式（默认选中）
2. 选择质量设置：
   - 高质量（原始）
   - 中等质量（推荐）
   - 低质量（小文件）
3. 可选择启用智能压缩
4. 点击"导出WebM"
5. 等待导出完成，文件将自动下载

### 3. MP4 格式导出测试

在格式选择器中：
1. 选择 MP4 格式
2. 选择编码器：
   - H.264（兼容性最佳）
   - H.265（文件更小）
3. 选择编码速度：
   - 快速（质量较低）
   - 平衡
   - 慢速（质量最佳）
4. 选择质量等级
5. 点击"导出MP4"
6. 等待转换完成，文件将自动下载

**注意**：MP4 转换需要 mp4box.js 库支持。如果转换失败，会返回原始 WebM 文件。

### 4. GIF 格式导出测试

在格式选择器中：
1. 选择 GIF 格式
2. 选择尺寸：
   - 480p（推荐）
   - 360p（较小）
   - 240p（最小）
3. 选择帧率：
   - 10 FPS（推荐）
   - 15 FPS（流畅）
   - 5 FPS（文件小）
4. 调整质量滑块（1-30，数值越小质量越高）
5. 选择最大时长（10/20/30/60秒）
6. 点击"导出GIF"
7. 等待帧提取和渲染，查看进度提示
8. 文件将自动下载

### 5. 测试页面

也可以使用 `test-export.html` 进行功能测试：
1. 打开 `test-export.html`
2. 选择一个本地视频文件
3. 点击各个测试按钮：
   - "打开格式选择器" - 测试UI
   - "测试 WebM 导出" - 直接测试WebM
   - "测试 MP4 导出" - 直接测试MP4
   - "测试 GIF 导出" - 直接测试GIF
   - "测试 Worker" - 测试Worker通信

## 常见问题

### Q: MP4 导出失败
A: 检查以下几点：
- 确保 `libs/mp4box.all.js` 文件存在
- 查看控制台是否有加载错误
- 尝试使用较小的视频文件

### Q: GIF 导出很慢
A: GIF 导出需要逐帧处理，这是正常的。建议：
- 减小输出尺寸（使用240p或360p）
- 降低帧率（使用5 FPS）
- 限制最大时长

### Q: 导出的文件无法播放
A: 
- WebM：大多数现代浏览器都支持
- MP4：检查是否成功转换（查看控制台日志）
- GIF：应该在所有浏览器中都能显示

## 性能优化建议

1. **大文件处理**
   - 录制时间控制在1分钟以内
   - GIF导出建议不超过30秒
   - 选择合适的质量设置

2. **浏览器兼容性**
   - Chrome/Edge：完全支持
   - Firefox：WebM和GIF支持良好
   - Safari：可能需要额外处理

3. **内存管理**
   - 处理大视频时关闭其他标签页
   - 导出完成后刷新页面释放内存

## 调试信息

打开浏览器开发者工具（F12），在控制台中可以看到：
- 导出进度信息
- Worker 通信日志
- 错误详细信息
- 性能统计

## 文件结构

```
/libs/
  ├── mp4box.all.js    # MP4容器处理库
  ├── gif.min.js        # GIF编码器主文件
  └── gif.worker.js     # GIF编码Worker

/popup/
  ├── export.worker.js         # 导出处理Worker
  ├── formatExportManager.js   # 导出管理器
  ├── formatSelector.js        # 格式选择器UI
  └── formatSelector.css       # 格式选择器样式
```

## 下一步优化

1. **添加更多格式支持**
   - AVI
   - MOV
   - MKV

2. **高级功能**
   - 批量导出
   - 自定义预设
   - 云端处理

3. **性能优化**
   - 使用 WebAssembly 加速
   - 实现流式处理
   - 添加缓存机制
