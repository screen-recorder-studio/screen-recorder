# SRS Master Calibration Chart (基准测试工具)

**版本:** 4.0 (裁剪/剪辑增强版)  
**路径:** `lab/test-pattern/index.html`

本工具是一个综合性的、基于浏览器的视频测试图案生成器，旨在验证 Screen Recorder Studio (以及其他视频录制软件) 的性能、精确度和编码质量。

它替代了传统的静态测试图片，使用动态的、确定性的渲染循环来暴露**码率控制、帧率稳定性、色度采样以及音画同步**方面的问题。

---

## 🎯 测试区域与结果判读指南

屏幕被划分为 8 个活跃区域，每个区域专门针对一种特定的编码伪影或缺陷。

### 1. 码率压力测试 (Bitrate Stress / Entropy Noise)
*   **位置:** 左上角面板
*   **功能:** 以 60fps 渲染高频随机噪声（电视雪花）。
*   **工程目的:** 迫使视频编码器 (H.264/VP9/AV1) 耗尽其码率预算。由于帧与帧之间毫无关联，帧间压缩 (Inter-frame compression) 将完全失效。
*   **如何判读:**
    *   **通过:** 噪点清晰、锐利，呈现颗粒感。
    *   **失败:** 噪点变成了大块的马赛克 (Macroblocking)，或者帧率显著下降。

### 2. 色度采样测试 (Chroma Subsampling 4:2:0)
*   **位置:** 顶部中间面板
*   **功能:** 显示特定配色的文本（红底蓝字、红底青字）。
*   **工程目的:** 大多数录屏软件为了节省带宽，使用 YUV 4:2:0 色彩空间，这会砍掉一半的色彩分辨率。
*   **如何判读:**
    *   **通过 (4:4:4):** 文字边缘清晰锐利。
    *   **失败 (4:2:0):** 文字边缘模糊、难以辨认，或出现黑边。这证实了录制软件正在压缩色彩数据。

### 3. 立体声音画同步 (Stereo Audio Sync)
*   **位置:** 顶部中间 (视觉) & 音频输出
*   **功能:** 每 2 秒交替播放提示音：低音 (左声道) -> 高音 (右声道)。屏幕上的 `L` / `R` 指示灯与声音完美同步闪烁。
*   **如何判读:**
    *   **同步性:** 听到声音的瞬间，指示灯刚好亮起。
    *   **声道检查:** 如果你在两只耳朵里都听到了同一个声音 (单声道)，说明录制软件存在立体声混音 Bug。

### 4. 渲染抖动图表 (Render Jitter Graph)
*   **位置:** 右上角面板
*   **功能:** 绘制每两帧之间的时间差 (60Hz 下应为 ~16.6ms)。
*   **如何判读:**
    *   **绿条:** 浏览器渲染流畅。
    *   **红条:** 浏览器自身卡顿。
    *   **诊断:** 如果*录制的视频*卡顿，但这些柱状图是*绿色*的，说明问题出在录制软件，而不是源 PC 性能不足。

### 5. 动态波带片 (Dynamic Zone Plate)
*   **位置:** 中间左侧面板
*   **功能:** 渲染同心正弦波纹图案，并进行缓慢的相位偏移。
*   **如何判读:**
    *   **失败:** 如果移动的圆环剧烈闪烁，或者出现了原本不存在的干扰纹理 (摩尔纹)，说明缩放算法或编码器质量较差。

### 6. 中央舞台 (时序与裁剪)
*   **位置:** 正中央
*   **特性:**
    *   **西门子星 (Siemens Star):** 旋转矢量图形。如果垂直同步 (V-Sync) 失效，会看到明显的画面撕裂 (水平切线)。
    *   **时间码:** `MM:SS:ms`。精确到帧的时间戳，用于测量延迟。
    *   **二进制计数器:** 16位二进制显示帧号。用于自动化脚本检测丢帧。
    *   **时序色相 (Temporal Color Phase):** 全局主题色每 10 秒变换一次 (蓝->绿->红->黄)。
        *   *用途:* 验证“剪辑 (Trim)”功能。(例如: "剪掉前 15 秒" -> 视频开始时必须是绿色主题)。

### 7. 色深与断层 (Bit Depth / Banding)
*   **位置:** 左下角面板
*   **功能:** 显示 32 阶量化灰度条 vs 平滑渐变条。
*   **如何判读:**
    *   **失败:** 如果 32 个清晰的色块融合在了一起，变成了更少的大色块，说明编码器降低了色深，或者过度压缩抹平了细节。

### 8. 运动与撕裂 (Motion & Tearing)
*   **位置:** 底部面板
*   **功能:** 一个 UFO 飞船以恒定速度水平飞过垂直的撕裂检测线。
*   **如何判读:**
    *   **卡顿:** 如果 UFO 运动不平滑，说明帧率步调 (Frame Pacing) 不均匀。

---

## 📐 全屏特性

### 坐标网格壁纸 (v4 新增)
背景是一个动态生成的网格，每 100px 的交叉点都印有 `(x, y)` 坐标。
*   **用途:** 验证 **裁剪 (Crop)** 功能。
*   **示例:** 如果你设置裁剪参数为 `x:100, y:100`，录制视频的左上角应该精确显示标记为 `100,100` 的交叉点。

### 性能架构
*   **噪声生成:** 使用包含 4 帧噪声的预计算缓冲区，在模拟高熵画面的同时不阻塞主线程 (CPU 占用 < 5%)。
*   **同步机制:** 所有的动画 (星星、UFO、指示灯) 都由单一的 `requestAnimationFrame` 循环驱动，并以 `AudioContext.currentTime` 或 `performance.now()` 作为主时钟源，确保绝对同步。

---

## 🛠 使用说明

1.  **打开:** 在 Chrome 浏览器中打开 `lab/test-pattern/index.html`。
2.  **启动:** 点击屏幕任意位置以初始化音频上下文 (Audio Context)。
3.  **全屏:** 按 F11 获得最佳效果 (移除浏览器 UI 干扰)。
4.  **录制:** 启动你的屏幕录制软件。
5.  **分析:** 回放录制的文件，并对照上述指南检查问题。
