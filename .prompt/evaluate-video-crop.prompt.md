# Video Crop 功能端到端评估

Video Crop 功能允许用户对源视频画面进行非破坏性的裁剪，通过定义感兴趣区域（ROI）来去除多余边缘或重构画面比例，最终输出符合特定画幅要求的视频。

**已实现的核心能力：**
1.  **非破坏性编辑**：裁剪操作仅改变渲染参数，始终保留原始视频数据，支持随时撤销或重新调整。
2.  **源空间裁剪 (Source-Space Cropping)**：在原始视频分辨率空间下进行裁剪定义，确保裁剪精度不受画布缩放或 Padding 影响，实现“所见即所得”。
3.  **专业级交互面板**：
    *   **像素级微调**：支持通过键盘方向键（Shift 加速）进行 1px 级别的精准调整。
    *   **数值输入**：提供 X, Y, W, H 输入框，支持精确数值设定。
    *   **比例控制**：支持常用比例预设（16:9, 1:1 等）及 Shift 键/UI 锁定宽高比。
    *   **可视化引导**：提供“中间亮、四周暗”的遮罩效果及九宫格辅助线，辅助构图。
4.  **Worker 级高性能渲染**：实际裁剪逻辑在 `composite-worker` 中执行，支持流式处理和实时预览，主线程仅处理 UI 交互，互不阻塞。
5.  **全局状态同步**：通过 Store 管理裁剪状态，并在不同组件（如文件管理、导出面板）间自动同步。

请端到端评估功能：

1.  负责状态管理，管理裁剪启用状态、模式（像素/百分比）及坐标数据，提供双向转换逻辑 `src/lib/stores/video-crop.svelte.ts`
2.  负责渲染引擎，在 Worker 线程中执行实际的画面裁切与合成，处理源裁剪与 Zoom 的渲染管线顺序 `src/lib/workers/composite-worker/index.ts`
3.  负责预览交互，作为协调层处理“进入/退出裁剪模式”的流程，负责请求源视频帧（Source Frame）供编辑使用 `src/lib/components/VideoPreviewComposite.svelte`
4.  负责编辑交互，提供在静态源帧上的裁剪框绘制、拖拽、缩放及键盘微调交互，包含遮罩绘制逻辑 `src/lib/components/VideoCropPanel.svelte`
