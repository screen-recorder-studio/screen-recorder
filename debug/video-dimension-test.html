<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘å°ºå¯¸æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-case {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-case h3 {
            margin-top: 0;
            color: #333;
        }
        .canvas-container {
            display: inline-block;
            margin: 10px;
            border: 2px solid #333;
            position: relative;
        }
        .canvas-info {
            position: absolute;
            top: -25px;
            left: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 2px 8px;
            font-size: 12px;
            border-radius: 3px;
        }
        canvas {
            display: block;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .dimensions {
            font-family: monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” è§†é¢‘å°ºå¯¸å¤„ç†æµ‹è¯•</h1>
        <p>æµ‹è¯•ä¸åŒå°ºå¯¸çš„è§†é¢‘åœ¨16:9ç”»å¸ƒä¸­çš„å¸ƒå±€æ•ˆæœ</p>

        <div class="controls">
            <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>

        <div class="test-case">
            <h3>æµ‹è¯•ç”¨ä¾‹ 1: ç«–å‘è§†é¢‘ (772Ã—1093) åœ¨ 16:9 ç”»å¸ƒä¸­</h3>
            <div class="dimensions">
                æºè§†é¢‘: 772Ã—1093 (çºµæ¨ªæ¯”: 0.706)<br>
                ç›®æ ‡ç”»å¸ƒ: 16:9 (çºµæ¨ªæ¯”: 1.778)<br>
                æœŸæœ›: è§†é¢‘ä¿æŒæ¯”ä¾‹ï¼Œæ°´å¹³å±…ä¸­ï¼Œä¸¤ä¾§ç•™ç™½
            </div>
            <div id="test1-result"></div>
            <div id="test1-canvas"></div>
        </div>

        <div class="test-case">
            <h3>æµ‹è¯•ç”¨ä¾‹ 2: æ¨ªå‘è§†é¢‘ (1920Ã—1080) åœ¨ 16:9 ç”»å¸ƒä¸­</h3>
            <div class="dimensions">
                æºè§†é¢‘: 1920Ã—1080 (çºµæ¨ªæ¯”: 1.778)<br>
                ç›®æ ‡ç”»å¸ƒ: 16:9 (çºµæ¨ªæ¯”: 1.778)<br>
                æœŸæœ›: å®Œç¾åŒ¹é…ï¼Œæ— ç•™ç™½
            </div>
            <div id="test2-result"></div>
            <div id="test2-canvas"></div>
        </div>

        <div class="test-case">
            <h3>æµ‹è¯•ç”¨ä¾‹ 3: æ–¹å½¢è§†é¢‘ (1080Ã—1080) åœ¨ 16:9 ç”»å¸ƒä¸­</h3>
            <div class="dimensions">
                æºè§†é¢‘: 1080Ã—1080 (çºµæ¨ªæ¯”: 1.000)<br>
                ç›®æ ‡ç”»å¸ƒ: 16:9 (çºµæ¨ªæ¯”: 1.778)<br>
                æœŸæœ›: è§†é¢‘ä¿æŒæ¯”ä¾‹ï¼Œæ°´å¹³å±…ä¸­ï¼Œä¸¤ä¾§ç•™ç™½
            </div>
            <div id="test3-result"></div>
            <div id="test3-canvas"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿ calculateOutputSize å‡½æ•°
        function calculateOutputSize(sourceWidth, sourceHeight, outputRatio = '16:9', padding = 60) {
            const targetRatios = {
                '16:9': 16 / 9,
                '1:1': 1,
                '9:16': 9 / 16,
                '4:5': 4 / 5
            };
            
            const targetCanvasRatio = targetRatios[outputRatio] || targetRatios['16:9'];
            const minContentWidth = sourceWidth + padding * 2;
            const minContentHeight = sourceHeight + padding * 2;
            
            let outputWidth, outputHeight;
            
            if (targetCanvasRatio >= 1) {
                // æ¨ªå‘æˆ–æ–¹å½¢ç”»å¸ƒ
                const widthBasedHeight = minContentWidth / targetCanvasRatio;
                
                if (widthBasedHeight >= minContentHeight) {
                    outputWidth = Math.max(minContentWidth, 1280);
                    outputHeight = Math.round(outputWidth / targetCanvasRatio);
                } else {
                    outputHeight = minContentHeight;
                    outputWidth = Math.round(outputHeight * targetCanvasRatio);
                }
            } else {
                // ç«–å‘ç”»å¸ƒ
                const heightBasedWidth = minContentHeight * targetCanvasRatio;
                
                if (heightBasedWidth >= minContentWidth) {
                    outputHeight = Math.max(minContentHeight, 1280);
                    outputWidth = Math.round(outputHeight * targetCanvasRatio);
                } else {
                    outputWidth = minContentWidth;
                    outputHeight = Math.round(outputWidth / targetCanvasRatio);
                }
            }
            
            return { outputWidth, outputHeight };
        }

        // æ¨¡æ‹Ÿ calculateVideoLayout å‡½æ•°
        function calculateVideoLayout(outputWidth, outputHeight, videoWidth, videoHeight, padding = 60) {
            const totalPadding = padding;
            const availableWidth = outputWidth - totalPadding * 2;
            const availableHeight = outputHeight - totalPadding * 2;
            
            const videoAspectRatio = videoWidth / videoHeight;
            const availableAspectRatio = availableWidth / availableHeight;
            
            let layoutWidth, layoutHeight, layoutX, layoutY;
            
            if (videoAspectRatio > availableAspectRatio) {
                // è§†é¢‘æ›´å®½ï¼Œä»¥å¯ç”¨å®½åº¦ä¸ºå‡†
                layoutWidth = availableWidth;
                layoutHeight = availableWidth / videoAspectRatio;
                layoutX = totalPadding;
                layoutY = totalPadding + (availableHeight - layoutHeight) / 2;
            } else {
                // è§†é¢‘æ›´é«˜ï¼Œä»¥å¯ç”¨é«˜åº¦ä¸ºå‡†
                layoutHeight = availableHeight;
                layoutWidth = availableHeight * videoAspectRatio;
                layoutX = totalPadding + (availableWidth - layoutWidth) / 2;
                layoutY = totalPadding;
            }
            
            return { x: layoutX, y: layoutY, width: layoutWidth, height: layoutHeight };
        }

        // ç»˜åˆ¶æµ‹è¯•ç»“æœ
        function drawTest(testId, sourceWidth, sourceHeight, outputRatio = '16:9') {
            const { outputWidth, outputHeight } = calculateOutputSize(sourceWidth, sourceHeight, outputRatio);
            const layout = calculateVideoLayout(outputWidth, outputHeight, sourceWidth, sourceHeight);
            
            // åˆ›å»ºç”»å¸ƒ
            const canvas = document.createElement('canvas');
            const scale = 0.3; // ç¼©æ”¾æ˜¾ç¤º
            canvas.width = outputWidth * scale;
            canvas.height = outputHeight * scale;
            
            const ctx = canvas.getContext('2d');
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶è§†é¢‘åŒºåŸŸ
            ctx.fillStyle = '#007bff';
            ctx.fillRect(
                layout.x * scale,
                layout.y * scale,
                layout.width * scale,
                layout.height * scale
            );
            
            // ç»˜åˆ¶è¾¹æ¡†
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.strokeRect(0, 0, canvas.width, canvas.height);
            
            // æ·»åŠ åˆ°é¡µé¢
            const container = document.getElementById(`${testId}-canvas`);
            container.innerHTML = '';
            
            const canvasContainer = document.createElement('div');
            canvasContainer.className = 'canvas-container';
            
            const info = document.createElement('div');
            info.className = 'canvas-info';
            info.textContent = `${outputWidth}Ã—${outputHeight}`;
            
            canvasContainer.appendChild(info);
            canvasContainer.appendChild(canvas);
            container.appendChild(canvasContainer);
            
            // è®¡ç®—ç»“æœ
            const sourceAspectRatio = sourceWidth / sourceHeight;
            const layoutAspectRatio = layout.width / layout.height;
            const aspectRatioDiff = Math.abs(sourceAspectRatio - layoutAspectRatio);
            const isProportional = aspectRatioDiff < 0.01;
            
            const scaleX = layout.width / sourceWidth;
            const scaleY = layout.height / sourceHeight;
            const distortionRatio = Math.max(scaleX, scaleY) / Math.min(scaleX, scaleY);
            
            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById(`${testId}-result`);
            const resultClass = isProportional && distortionRatio < 1.01 ? 'success' : 'error';
            
            resultDiv.innerHTML = `
                <div class="result ${resultClass}">
                    <strong>æµ‹è¯•ç»“æœ:</strong><br>
                    ç”»å¸ƒå°ºå¯¸: ${outputWidth}Ã—${outputHeight} (${(outputWidth/outputHeight).toFixed(3)})<br>
                    è§†é¢‘å¸ƒå±€: ${layout.width.toFixed(0)}Ã—${layout.height.toFixed(0)} at (${layout.x.toFixed(0)}, ${layout.y.toFixed(0)})<br>
                    æ¯”ä¾‹ä¿æŒ: ${isProportional ? 'âœ… æ­£ç¡®' : 'âŒ é”™è¯¯'}<br>
                    å¤±çœŸæ¯”ä¾‹: ${distortionRatio.toFixed(3)} ${distortionRatio < 1.01 ? 'âœ…' : 'âš ï¸'}<br>
                    ç¼©æ”¾æ¯”ä¾‹: X=${scaleX.toFixed(3)}, Y=${scaleY.toFixed(3)}
                </div>
            `;
        }

        function runAllTests() {
            drawTest('test1', 772, 1093);   // ç«–å‘è§†é¢‘
            drawTest('test2', 1920, 1080);  // æ¨ªå‘è§†é¢‘
            drawTest('test3', 1080, 1080);  // æ–¹å½¢è§†é¢‘
        }

        function clearResults() {
            ['test1', 'test2', 'test3'].forEach(testId => {
                document.getElementById(`${testId}-result`).innerHTML = '';
                document.getElementById(`${testId}-canvas`).innerHTML = '';
            });
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæµ‹è¯•
        window.onload = runAllTests;
    </script>
</body>
</html>
